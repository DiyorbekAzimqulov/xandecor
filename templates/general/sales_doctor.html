{% extends "general/main.html" %} {% load static %} {% load custom_filters %}

<!-- Title -->
{% block title %}Sales Doctor{% endblock %}

<!-- Style -->
{% block style %}
<link rel="stylesheet" href="{% static 'css/sales_doctor.css' %}" />

<style>
  body {
    padding-top: 56px; /* Height of the navbar */
  }
</style>
{% endblock %}

<!-- Sidebar -->
{% block sidebar %} {% include "_sidebar.html" %}{% endblock %}

<!-- Content -->
{% block content %}
<div class="container mt-4">
  <h2 class="mb-1 text-center"><b>Sales Doctor</b></h2>

  {% if status %}
  <div class="table-responsive ml-5">
    <table class="table table-bordered">
      <thead>
        <tr>
          <th rowspan="2"><small>№</small></th>
          <th rowspan="2"><small>Name</small></th>
          {% for warehouse in warehouse_names %} {% if warehouse == "Основной склад" %}
          <th class="warehouse-cell-main" rowspan="2">
            <small>{{ warehouse }}</small> <i class="fas fa-warehouse"></i>
          </th>
          {% elif warehouse == "Secondary Warehouse 1" %}
          <th class="warehouse-cell-secondary-1" colspan="3">
            <small>{{ warehouse }}</small> <i class="fas fa-warehouse"></i>
          </th>
          {% elif warehouse == "Secondary Warehouse 2" %}
          <th class="warehouse-cell-secondary-2" colspan="3">
            <small>{{ warehouse }}</small> <i class="fas fa-warehouse"></i>
          </th>
          {% elif warehouse == "Secondary Warehouse 3" %}
          <th class="warehouse-cell-secondary-3" colspan="3">
            <small>{{ warehouse }}</small> <i class="fas fa-warehouse"></i>
          </th>
          {% else %}
          <th class="warehouse-cell-secondary" colspan="3">
            <small>{{ warehouse }}</small> <i class="fas fa-warehouse"></i>
          </th>
          {% endif %} {% endfor %}
          <th rowspan="2"><small>Total Otxod</small> <i class="fas fa-trash-alt"></i></th>
        </tr>
        <tr>
          {% for warehouse in warehouse_names %} {% if warehouse != "Основной склад" %}
          <th class="warehouse-cell-secondary">
            <small>Prixod</small> <i class="fas fa-arrow-down symbol-cell prixod"></i>
          </th>
          <th class="warehouse-cell-secondary">
            <small>Sold</small> <i class="fas fa-arrow-up symbol-cell sold"></i>
          </th>
          <th class="warehouse-cell-secondary">
            <small>Otxod</small> <i class="fas fa-trash-alt symbol-cell ostatok"></i>
          </th>
          {% endif %} {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for product_name, data in product_data.items %}
        <tr class="{{ forloop.counter0|divisibleby:2|yesno:'row-even,row-odd' }}">
          <td data-label="No."><small>{{ forloop.counter }}</small></td>
          <td data-label="Product"><small>{{ product_name }}</small></td>
          {% for warehouse in warehouse_names %}
          <!-- with -->
          {% with warehouse_data=data.stores|get_item:warehouse %}
          <!-- checking warehouse -->
          {% if warehouse_data %} {% if warehouse == "Основной склад" %}
          <td class="warehouse-cell-main" data-label="Ostatok">
            <small>{{ warehouse_data.ostatok }}</small>
            <i class="fas fa-arrow-down symbol-cell prixod"></i>
          </td>
          {% else %}
          <td class="warehouse-cell-secondary" data-label="Prixod">
            <small>{{ warehouse_data.prixod }}</small>
            <i class="fas fa-arrow-down symbol-cell prixod"></i>
          </td>
          <td class="warehouse-cell-secondary" data-label="Sold">
            <small>{{ warehouse_data.sold }}</small>
            <i class="fas fa-arrow-up symbol-cell sold"></i>
          </td>
          <td class="warehouse-cell-secondary" data-label="Ostatok">
            <small>{{ warehouse_data.ostatok }}</small>
            <i class="fas fa-trash-alt symbol-cell ostatok"></i>
          </td>
          {% endif %} {% else %}
          <td class="warehouse-cell-secondary" data-label="Ostatok"><small>0</small></td>
          {% if warehouse != "Основной склад" %}
          <td class="warehouse-cell-secondary" data-label="Prixod"><small>0</small></td>
          <td class="warehouse-cell-secondary" data-label="Sold"><small>0</small></td>
          {% endif %} {% endif %} {% endwith %} {% endfor %}
          <td data-label="Total Ostatok">
            <small>{{ data.total_ostatok }}</small>
            <i class="fas fa-trash-alt symbol-cell ostatok"></i>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <p class="text-center">{{ error }}</p>
  {% endif %}
</div>
{% endblock %}

<!-- Script -->
{% block script %}
<script src="{% static 'js/sales_doctor.js' %}"></script>
{% endblock %}
